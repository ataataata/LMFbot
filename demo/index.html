<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Local Chat Widget â€“ Typing Indicator</title>

<!-- Markdown renderer -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
/* Chat Widget Styles (identical to WP version) */
#chat-toggle{position:fixed;bottom:28px;right:28px;z-index:9999;width:56px;height:56px;
  border:none;border-radius:50%;background:#000;color:#fff;font-size:24px;cursor:pointer;
  box-shadow:0 4px 16px rgba(0,0,0,.25)}
#chat-toggle:active{transform:scale(.96)}
#chat-container{position:fixed;bottom:96px;right:28px;z-index:9999;width:350px;height:460px;
  display:flex;flex-direction:column;background:#fff;border:2px solid #000;border-radius:12px;
  box-shadow:0 12px 32px rgba(0,0,0,.25)}
#chat-container.hidden{display:none}
#close-chat{position:absolute;top:12px;right:14px;border:none;background:transparent;
  font-size:22px;font-weight:700;color:#666;cursor:pointer}
#close-chat:hover{color:#000}
#chat-messages{flex:1;overflow-y:auto;padding:64px 14px 14px;display:flex;
  flex-direction:column;gap:8px;scroll-behavior:smooth}
.message{display:inline-block;max-width:85%;padding:6px 12px;border-radius:14px;font-size:13px;
  line-height:1.35;word-wrap:break-word;white-space:pre-wrap}
.user-message{align-self:flex-end;background:#000;color:#fff;border-bottom-right-radius:4px}
.bot-message{align-self:flex-start;background:#e8e8e8;color:#000;border-bottom-left-radius:4px}
.message p{margin:0 !important}
.message p:first-child{margin-top:0 !important}
.message p:last-child{margin-bottom:0 !important}
.message ul,.message ol{margin:4px 0 !important;padding-left:16px}
.message li{margin:2px 0 !important}
.message h1,.message h2,.message h3,.message h4,.message h5,.message h6{margin:4px 0 !important}
.message code{background:#f0f0f0;padding:1px 3px;border-radius:3px}
.message pre{background:#f0f0f0;padding:8px;border-radius:4px;margin:4px 0 !important;overflow-x:auto}
.typing{display:inline-flex;gap:3px}
.typing span{width:6px;height:6px;border-radius:50%;background:#555;animation:blink 1s infinite}
.typing span:nth-child(2){animation-delay:.15s}
.typing span:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%{opacity:.2}40%{opacity:1}}
#chat-footer{display:flex;padding:10px;border-top:1px solid #eee}
#chat-input{flex:1;padding:8px;border:1px solid #ccc;border-radius:8px;font:14px/1.45 system-ui}
#send-message{margin-left:8px;padding:0 18px;border:none;border-radius:8px;background:#000;
  color:#fff;font-weight:600;cursor:pointer}
#send-message:active{transform:scale(.97)}
</style>
</head>
<body>

<!-- Launcher -->
<button id="chat-toggle">ðŸ’¬</button>

<!-- Panel -->
<div id="chat-container" class="hidden">
  <button id="close-chat">âœ•</button>
  <div id="chat-messages"></div>
  <div id="chat-footer">
    <input id="chat-input" placeholder="Type a messageâ€¦" autocomplete="off">
    <button id="send-message">Send</button>
  </div>
</div>

<script>
(function () {
  /* CONFIG â€” use your local backend while testing */
  const BACKEND_URL = "https://ialschatbot.duckdns.org/chat"; 

  const $ = id => document.getElementById(id);
  const chatToggle = $('chat-toggle'), chatBox = $('chat-container'), closeBtn = $('close-chat');
  const input = $('chat-input'), sendBtn = $('send-message'), messages = $('chat-messages');

  let greeted = false, typingDiv = null;

  chatToggle.addEventListener('click', () => {
    chatBox.classList.remove('hidden');
    if (!greeted) { append("Hello! How can I help you today?","bot"); greeted = true; }
  });
  closeBtn.addEventListener('click', () => chatBox.classList.add('hidden'));

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });

  async function sendMessage(){
    const text = input.value.trim();
    if(!text) return;
    append(text,'user');
    input.value = '';
    showTyping();
    try{
      const res = await fetch(BACKEND_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({message:text})
      });
      if(!res.ok) throw new Error(res.statusText);
      const data = await res.json();
      hideTyping();
      append(data.answer || '(no answer)','bot');
    }catch(err){
      console.error(err);
      hideTyping();
      append('Sorry, there was an error.','bot');
    }
  }

  function append(text, who){
    const div = document.createElement('div');
    div.className = 'message ' + who + '-message';
    if (who === 'bot' && typeof marked !== 'undefined'){
      let html = marked.parse(text.trim()).trim().replace(/<p>\s*<\/p>/g,'');
      div.innerHTML = html;
    } else {
      div.textContent = text;
    }
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function showTyping(){
    hideTyping();
    typingDiv = document.createElement('div');
    typingDiv.className = 'message bot-message';
    typingDiv.innerHTML = '<span class="typing"><span></span><span></span><span></span></span>';
    messages.appendChild(typingDiv);
    messages.scrollTop = messages.scrollHeight;
  }
  function hideTyping(){ if(typingDiv){ typingDiv.remove(); typingDiv=null; } }

})();
</script>
</body>
</html>




<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Local Chat Widget â€“ Typing Indicator</title>

<!-- Markdown renderer -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
/* ---------- Compact Chat Widget v4 (typing dots) ------------------- */
body{margin:0;font:14px/1.45 system-ui;background:#fafafa;overflow-x:hidden}

#chat-toggle{position:fixed;bottom:28px;right:28px;z-index:9999;width:56px;height:56px;
  border:none;border-radius:50%;background:#000;color:#fff;font-size:24px;cursor:pointer;
  box-shadow:0 4px 16px rgba(0,0,0,.25)}
#chat-toggle:active{transform:scale(.96)}

#chat-container{position:fixed;bottom:96px;right:28px;z-index:9999;width:350px;height:460px;
  display:flex;flex-direction:column;background:#fff;border:2px solid #000;border-radius:12px;
  box-shadow:0 12px 32px rgba(0,0,0,.25)}
#chat-container.hidden{display:none}

#close-chat{position:absolute;top:12px;right:14px;border:none;background:transparent;
  font-size:22px;font-weight:700;color:#666;cursor:pointer}
#close-chat:hover{color:#000}

#chat-messages{flex:1;overflow-y:auto;padding:64px 14px 14px;display:flex;
  flex-direction:column;gap:8px;scroll-behavior:smooth}

.message{display:inline-block;max-width:85%;padding:6px 12px;border-radius:14px;font-size:13px;
  line-height:1.35;word-wrap:break-word;white-space:pre-wrap}
.user-message{align-self:flex-end;background:#000;color:#fff;border-bottom-right-radius:4px}
.bot-message{align-self:flex-start;background:#e8e8e8;color:#000;border-bottom-left-radius:4px}
.message p{margin:0}

/* typing dots */
.typing{display:inline-flex;gap:3px}
.typing span{width:6px;height:6px;border-radius:50%;background:#555;animation:blink 1s infinite}
.typing span:nth-child(2){animation-delay:.15s}
.typing span:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%{opacity:.2}40%{opacity:1}}

#chat-footer{display:flex;padding:10px;border-top:1px solid #eee}
#chat-input{flex:1;padding:8px;border:1px solid #ccc;border-radius:8px;font:14px system-ui}
#send-message{margin-left:8px;padding:0 18px;border:none;border-radius:8px;background:#000;
  color:#fff;font-weight:600;cursor:pointer}
#send-message:active{transform:scale(.97)}
</style>
</head>
